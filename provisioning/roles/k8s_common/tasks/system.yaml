---
- name: Disable firewalld
  ansible.builtin.service:
    name: firewalld
    state: stopped
    enabled: false

- name: Disable swap
  block:
    - name: Disable swap for current session
      ansible.builtin.command: swapoff -a
      changed_when: false

    - name: Disable swap permanently
      ansible.builtin.replace:
        path: /etc/fstab
        regexp: "^(\\s*)([^#\\n]+\\s+)(\\w+\\s+)swap(\\s+.*)$"
        replace: "#\\1\\2\\3swap\\4"
        backup: true

- name: Enable IPv4 packet forwarding
  ansible.posix.sysctl:
    name: net.ipv4.ip_forward
    value: "1"
    state: present
    sysctl_set: true
    reload: true

- name: Disable SELinux
  ansible.posix.selinux:
    state: disabled

- name: Reboot
  ansible.builtin.reboot:
